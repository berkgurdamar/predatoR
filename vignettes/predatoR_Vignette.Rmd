---
title: "Introduction to predatoR"
author: "Berk Gurdamar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to predatoR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
suppressPackageStartupMessages(library(predatoR))
```

# Quick Start

In this section, we show you how to use `predatoR` package for impact prediction.

`predatoR()` function is the wrapper function of the `predatoR` package. `predatoR()` 
gets a data.frame structure as an input. Input should contain 5 mandatory and 1 optional columns.
 Mandatory columns are  __'PDB_ID'__, __'Chain'__, __'Position'__, __'Orig_AA'__ and  __'Mut_AA'__.
 __'Gene_Name'__ column is optional. 
 
### Workflow

<img src="./predatoR_workflow.png" style="max-width:100%;" />

`predatoR()` function works on each PDB ID respectively. For each PDB ID;  

 - Download/Read PDB file
 - Calculate distances between every atom
 - Create network from PDB
 - Calculate Eigen Centrality Z-Score of each Carbon-α atom
 - Calculate Shortest Path Z-Score of each Carbon-α atom
 - Calculate Betweenness Z-Score of each Carbon-α atom
 - Gets GnomAD Synonymous Z-Score, Non-Synonymous Z-Score, and PLoF Score
 - Gets Genic Intolerance Score
 - Gets BLOSUM62 score of the mutation
 - Finds the number of KEGG Pathways which contains the input gene
 - Make prediction
 
If there are missing information such as no Genic Intolerance Score, these inputs will be removed from the query.
 
 
### Arguments
 
 `predatoR()` function has 4 arguments; 
 
 - info_df: Input data.frame
 - internal_PDB_path: PDB file path if PDB structures stored internally (default = NULL)
 - n_threads: number of threads (default = NULL)
 - gene_name_info: whether there is gene name information in the input or not (default = TRUE)
 
 When running the `predatoR()` function, if gene name is included in the input, `gene_name_info`
 should be set as `TRUE`. If there is no gene name information in the input (`gene_name_info = FALSE`), 
 `predatoR()` function gets the related gene names from __'Ensembl-BioMart'__ and if there are multiple
 genes annotated for the PDB ID, asks user to choose input __'Gene_Name'__. 
 
 
 Example input with __'Gene_Name'__ information included:
 
```{r example_gene_name, echo=TRUE}
test_data <- as.data.frame(rbind(c("2DN2", "B", 1, "VAL", "ALA", "HBB"),
                                 c("2DN2", "B", 6, "GLU", "ALA", "HBB")))
colnames(test_data) <- c("PDB_ID", "Chain", "Position", "Orig_AA", "Mut_AA", "Gene_Name")
knitr::kable(test_data, align = c("c", "c", "c", "c", "c", "c"))
```
 
```{r example_gene_name_run, eval=FALSE}

library(predatoR)
prediction_result <- predatoR(test_data, gene_name_info = TRUE)

```

Example input with __'Gene_Name'__ information does not included:
 
```{r example_no_gene_name, echo=TRUE}
test_data <- as.data.frame(rbind(c("2DN2", "B", 1, "VAL", "ALA"),
                                 c("2DN2", "B", 6, "GLU", "ALA")))
colnames(test_data) <- c("PDB_ID", "Chain", "Position", "Orig_AA", "Mut_AA")
knitr::kable(test_data, align = c("c", "c", "c", "c", "c"))
```
 
```{r example_no_gene_name_run, eval=FALSE}

prediction_result <- predatoR(test_data, gene_name_info = FALSE)

```

 
`predatoR()` function can work with partially added gene name informations. If some mutations has no gene name
information, it ets the related gene names from __'Ensembl-BioMart'__ and if there are multiple
 genes annotated for the PDB ID, asks user to choose input __'Gene_Name'__ (`gene_name_info` should set as `TRUE`).
 
 
```{r example_partial_gene_name, echo=TRUE}
test_data <- as.data.frame(rbind(c("2DN2", "B", 1, "VAL", "ALA", "HBB"),
                                 c("2DN2", "B", 6, "GLU", "ALA", "HBB"),
                                 c("4ONL", "A", 36, "GLU", "GLY", "")))
colnames(test_data) <- c("PDB_ID", "Chain", "Position", "Orig_AA", "Mut_AA", "Gene_Name")
knitr::kable(test_data, align = c("c", "c", "c", "c", "c", "c"))
```
 
```{r example_partial_gene_name_run, eval=FALSE}

prediction_result <- predatoR(test_data, gene_name_info = TRUE)

```
 
 
`predatoR()` function uses `max_thread_number - 1` as a default when `n_threads = NULL`. `n_threads` can be set
by user.
 

```{r example_thread_number, eval=FALSE}

prediction_result <- predatoR(test_data, n_threads = 8) # 8 threads will be used

```


`predatoR()` function downloads each PDB by default (`internal_PDB_path = NULL`) or can use PDB files stored 
internally when `internal_PDB_path` specified. It will automatically read and process the input PDB file from the 
path.
 

```{r example_path, eval=FALSE}

prediction_result <- predatoR(test_data, internal_PDB_path = "path/to/PDB/files/") 

```


### Result

`predatoR()` function returns a data.frame which contains additional two columns; __'Prediction'__ and __'Probability'__. __'Prediction'__ represents the result of the impact prediction and __'Probability'__ represents the probability that the mutation classified as __Disease Causing__ or __Silent__. 

```{r example_output, echo=FALSE}
example_result <- as.data.frame(rbind(c("2DN2", "B", 1, "VAL", "ALA", "HBB", "Silent", "0.6205009"),
                                      c("2DN2", "B", 6, "GLU", "ALA", "HBB", "Silent", "0.6286857")))

colnames(example_result) <- c("PDB_ID", "Chain", "Position", "Orig_AA", "Mut_AA", "Gene_Name", "Prediction", "Probability")

knitr::kable(example_result, align = c("c", "c", "c", "c", "c", "c", "c", "c"))
```
